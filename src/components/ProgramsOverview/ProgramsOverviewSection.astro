---
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";
import ProgramsOverviewCard from "./ProgramsOverviewCard.astro";
import { FaArrowRight } from "react-icons/fa";

type Program = CollectionEntry<"programs">;

const programs = await getCollection("programs");
const sortedPrograms = programs
  .sort((a: Program, b: Program) => (a.data.order || 999) - (b.data.order || 999))
  .slice(0, 4);
---

<section class="py-16 md:py-24 bg-ink-50">
  <div class="max-w-7xl mx-auto px-5 md:px-8 lg:px-12">
    
    <div class="text-center max-w-3xl mx-auto mb-16">
      <div class="flex items-center justify-center mb-2">
        <span class="subtitle">
          MH Aviation Training
        </span>
      </div>
      
      <h2 class="title-black">
        Family-Owned,<br> Integrity-Driven Training
      </h2>
      
      <p class="font-sans text-ink-600">
        From our family to yours, we offer fair, honest, and safety-focused flight instruction. Whether you're launching a professional career or fulfilling a lifelong dream, experience the difference of a true one-stop aviation hub at Fox Field.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
      {sortedPrograms.map((program, index) => (
        <ProgramsOverviewCard program={program} index={index} />
      ))}
    </div>

    <div class="text-center">
      <a  
        href="/programs/"
        class="btn-primary-overviews"
      >
        See Other Programs
        <FaArrowRight />
      </a>
    </div>

  </div>
</section>

<script>
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', 'translate-y-8');
        observer.unobserve(entry.target);
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px" 
  });

  const cards = document.querySelectorAll('.program-card');
  cards.forEach((card) => observer.observe(card));
</script>