---
import ImageComp from "./ImageComp.astro";
import {
  COMPANY_NAME,
  FACEBOOK_URL,
  INSTAGRAM_URL,
  LINKEDIN_URL,
  X_URL,
  LOGO_ASSETS,
  SITE_DESCRIPTION,
footerMenu,
} from "../data/consts";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

type Program = CollectionEntry<"programs">;
type Service = CollectionEntry<"services">;

const programs = await getCollection("programs");
const sortedPrograms = programs.sort(
  (a: Program, b: Program) => (a.data.order || 999) - (b.data.order || 999)
);

const services = await getCollection("services");
const sortedServices = services.sort(
  (a: Service, b: Service) => (a.data.order || 999) - (b.data.order || 999)
);

const today = new Date();
---

<footer class="w-full pt-12 text-ink-50 bg-ink-950">
  <div class="relative z-10 mx-auto sm:max-w-xl md:max-w-full xl:max-w-[90rem] px-4">
    <div class="flex flex-wrap justify-between items-start gap-y-12 xl:gap-y-0">
      
      <div class="w-full md:w-1/4 2xl:w-1/5 flex flex-col items-center  lg:items-start xl:items-center px-4">
        <a href="/" class="flex items-center justify-center mb-6 w-full">
          <ImageComp
            src={LOGO_ASSETS}
            class="w-48 h-auto object-contain"
            alt={`${COMPANY_NAME} Logo`}
          />
        </a>
        <p class="text-sm text-ink-50 mb-6 font-medium leading-relaxed text-center max-w-[85%] sm:max-w-[75%] md:max-w-full md:text-left xl:text-center">
          {SITE_DESCRIPTION}
        </p>

        <div class="flex gap-4">
          {FACEBOOK_URL && (
            <a href={FACEBOOK_URL} target="_blank" class="transition-colors duration-200 hover:text-ochre-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M22 12c0-5.52-4.48-10-10-10S2 6.48 2 12c0 4.84 3.44 8.87 8 9.8V15H8v-3h2V9.5C10 7.57 11.57 6 13.5 6H16v3h-2c-.55 0-1 .45-1 1v2h3v3h-3v6.95c5.05-.5 9-4.76 9-9.95"></path></svg>
            </a>
          )}
          {X_URL && (
            <a href={X_URL} target="_blank" class="transition-colors duration-200 hover:text-ochre-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M18.205 2.25h3.308l-7.227 8.26l8.502 11.24H16.13l-5.214-6.817L4.95 21.75H1.64l7.73-8.835L1.215 2.25H8.04l4.713 6.231zm-1.161 17.52h1.833L7.045 4.126H5.078z"></path></svg>
            </a>
          )}
          {INSTAGRAM_URL && (
            <a href={INSTAGRAM_URL} target="_blank" class="transition-colors duration-200 hover:text-ochre-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="currentColor" d="M12.001 9a3 3 0 1 0 0 6a3 3 0 0 0 0-6m0-2a5 5 0 1 1 0 10a5 5 0 0 1 0-10m6.5-.25a1.25 1.25 0 0 1-2.5 0a1.25 1.25 0 0 1 2.5 0M12.001 4c-2.474 0-2.878.007-4.029.058c-.784.037-1.31.142-1.798.332a2.9 2.9 0 0 0-1.08.703a2.9 2.9 0 0 0-.704 1.08c-.19.49-.295 1.015-.331 1.798C4.007 9.075 4 9.461 4 12c0 2.475.007 2.878.058 4.029c.037.783.142 1.31.331 1.797c.17.435.37.748.702 1.08c.337.336.65.537 1.08.703c.494.191 1.02.297 1.8.333C9.075 19.994 9.461 20 12 20c2.475 0 2.878-.007 4.029-.058c.782-.037 1.308-.142 1.797-.331a2.9 2.9 0 0 0 1.08-.703c.337-.336.538-.649.704-1.08c.19-.492.296-1.018.332-1.8c.052-1.103.058-1.49.058-4.028c0-2.474-.007-2.878-.058-4.029c-.037-.782-.143-1.31-.332-1.798a2.9 2.9 0 0 0-.703-1.08a2.9 2.9 0 0 0-1.08-.704c-.49-.19-1.016-.295-1.798-.331C14.926 4.006 14.54 4 12 4m0-2c2.717 0 3.056.01 4.123.06c1.064.05 1.79.217 2.427.465c.66.254 1.216.598 1.772 1.153a4.9 4.9 0 0 1 1.153 1.772c.247.637.415 1.363.465 2.428c.047 1.066.06 1.405.06 4.122s-.01 3.056-.06 4.122s-.218 1.79-.465 2.428a4.9 4.9 0 0 1-1.153 1.772a4.9 4.9 0 0 1-1.772 1.153c-.637.247-1.363.415-2.427.465c-1.067.047-1.406.06-4.123.06s-3.056-.01-4.123-.06c-1.064-.05-1.789-.218-2.427-.465a4.9 4.9 0 0 1-1.772-1.153a4.9 4.9 0 0 1-1.153-1.772c-.248-.637-.415-1.363-.465-2.428C2.012 15.056 2 14.717 2 12s.01-3.056.06-4.122s.217-1.79.465-2.428a4.9 4.9 0 0 1 1.153-1.772A4.9 4.9 0 0 1 5.45 2.525c.637-.248 1.362-.415 2.427-.465C8.945 2.013 9.284 2 12.001 2"></path></svg>
            </a>
          )}
          {LINKEDIN_URL && (
            <a href={LINKEDIN_URL} target="_blank" class="transition-colors duration-200 hover:text-ochre-600">
              <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2zm-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93zM6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37z"></path></svg>
            </a>
          )}
        </div>
      </div>

      {sortedPrograms && (
        <div class="w-full md:w-1/4 2xl:w-1/5 flex flex-col items-center md:items-start text-center md:text-left px-4 xl:pl-4 xl:pr-0">
          <a href="/programs/" class="font-main-header uppercase tracking-wide font-black text-xl hover:text-ochre-600 transition-colors mb-4 block">
            Programs
          </a>
          <ul class="font-sans space-y-2">
            <li class="text-sm">
              <a href={`/programs/`} class="text-ink-50 hover:text-ochre-600 transition-colors">
                All Programs
              </a>
            </li>
            {sortedPrograms.map((program) => (
              <li class="text-sm">
                <a href={`/programs/${program.slug}/`} class="text-ink-50 hover:text-ochre-600 transition-colors">
                  {program.data.title}
                </a>
              </li>
            ))}
          </ul>
        </div>
      )}

      {sortedServices && (
        <div class="w-full md:w-1/4 2xl:w-1/5 flex flex-col items-center md:items-start text-center md:text-left px-4 xl:pr-4 xl:pr-0">
          <a href="/maintenance-and-services/" class="font-main-header uppercase tracking-wide font-black text-xl hover:text-ochre-600 transition-colors mb-4 block">
            MAINTENANCE & FBO
          </a>
          <ul class="font-sans space-y-2">
            <li class="text-sm">
              <a href={`/services/`} class="text-ink-50 hover:text-ochre-600 transition-colors">
                All Services
              </a>
            </li>
            {sortedServices.map((service) => (
              <li class="text-sm">
                <a href={`/services/${service.slug}`} class="text-ink-50 hover:text-ochre-600 transition-colors">
                  {service.data.title}
                </a>
              </li>
            ))}
          </ul>
        </div>
      )}

      {footerMenu.map((item) => (
        <div class="w-full md:w-1/4 2xl:w-1/5 flex flex-col items-center md:items-start text-center md:text-left px-4">
          <a href={item.url} class="font-main-header uppercase tracking-wide font-black text-xl hover:text-ochre-600 transition-colors mb-4 block">
            {item.label}
          </a>
          <ul class="font-sans space-y-2">
            {item.children?.map((child) => (
              <li class="text-sm">
                <a href={child.url} class="text-ink-50 hover:text-ochre-600 transition-colors">
                  {child.label}
                </a>
              </li>
            ))}
          </ul>
        </div>
      ))}

      <div class="w-full 2xl:w-1/5 flex flex-col items-center 2xl:items-end justify-start mt-8 xl:mt-0">
        <div class="w-fit bg-ink-50 px-8 py-2 rounded-xl overflow-hidden shadow-inner">
          <p class="font-eader tracking-wide uppercase font-black text-lg text-center mb-4 text-ink-950">
            KWJF Weather
          </p>
          <div class="rounded-sm">
          <a href="https://metar-taf.com/metar/KWJF"
            id="metartaf-TIrJL2pk"
            class="block min-[200px]:w-[150px] min-[350px]:w-[250px] w-[200px] 2xl:w-[250px]"
            style="font-size:16px; font-weight:500; color:#0e0e0e;">METAR General WM J Fox Airfield</a>
          <script async defer crossorigin="anonymous" src="https://metar-taf.com/embed-js/KWJF?bg_color=f6f6f6&temp=f&layout=landscape&visibility=mi&qnh=inHg&rh=rh&target=TIrJL2pk"></script>
          </div>

        </div>
      </div>

    </div>

    <div class="w-full h-px bg-ink-800 my-10"></div>

    <div class="flex flex-col md:flex-row justify-between items-center gap-6 pb-8 text-sm text-ink-50">
      
      <span class="text-center md:text-left w-full md:w-auto">
        Powered by
        <a href="https://rightruddermarketing.com/" target="_blank" class="font-bold hover:text-ochre-600 transition-colors">
          More Right Rudder
        </a>
      </span>

      <p class="text-center w-full md:w-auto">
        &copy; Copyright {today.getFullYear()} • {COMPANY_NAME} • All rights reserved.
      </p>

      <p class="text-center md:text-right w-full md:w-auto">
        <a href="/privacy-policy/" class="hover:text-ochre-600 transition-colors">Privacy Policy</a>
        <span class="mx-2">•</span>
        <a href="/terms-of-service/" class="hover:text-ochre-600 transition-colors">Terms of Service</a>
      </p>
    </div>
  </div>
</footer>