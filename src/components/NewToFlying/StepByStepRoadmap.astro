---
import ImageComp from "../ImageComp.astro";

interface Props {
  data: {
    upperheader: string;
    title: string;
    steps: { number: string; title: string; description: string }[];
    cta: { text: string; href: string };
    image: { src: string; alt: string };
  };
}

const { data } = Astro.props;
---

<section class="relative py-24 md:py-32 bg-ink-950 overflow-hidden">
  
  <div class="absolute inset-0 z-0 opacity-20">
    <ImageComp 
      src={data.image.src} 
      alt={data.image.alt} 
      class="w-full h-full object-cover object-center" 
    />
  </div>

  <div class="max-w-7xl mx-auto px-5 md:px-8 lg:px-12 relative z-10">
    <div class="text-center mb-16 max-w-3xl mx-auto reveal-header opacity-0 translate-y-8 transition-all duration-1000 ease-out">
      <span class="text-ochre-500 font-bold uppercase tracking-widest text-sm mb-3 block">
        {data.upperheader}
      </span>
      <h2 class="text-3xl md:text-5xl !font-main-header text-white uppercase tracking-wide">
        {data.title}
      </h2>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
      {data.steps.map((step, index) => (
        <div 
          class="reveal-card bg-white p-8 rounded-sm shadow-lg border-t-4 border-ochre-600 hover:-translate-y-2 transition-all duration-700 ease-in-out group cursor-default opacity-0 translate-y-12"
          style={`transition-delay: ${index * 150}ms;`}
        >
        <span class="text-5xl font-black text-ink-100 mb-4 block group-hover:text-ochre-500 transition-colors duration-500 ease-in-out">
          {step.number}
        </span>
          <h3 class="text-xl font-bold text-ink-950 mb-3">{step.title}</h3>
          <p class="text-ink-600 text-sm leading-relaxed">{step.description}</p>
        </div>
      ))}
    </div>

    <div class="mt-16 text-center reveal-header opacity-0 translate-y-8 transition-all duration-1000 ease-out delay-500 flex justify-center">
      <a href={data.cta.href} class="btn-primary shadow-xl hover:cursor-pointer">{data.cta.text}</a>
    </div>
  </div>
</section>

<script>
  const observerOptions = {
    threshold: 0.15,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const headers = entry.target.querySelectorAll('.reveal-header');
        headers.forEach(el => {
            el.classList.remove('opacity-0', 'translate-y-8');
        });

        const cards = entry.target.querySelectorAll('.reveal-card');
        cards.forEach(el => {
          el.classList.remove('opacity-0', 'translate-y-12');
          el.classList.add('opacity-100', 'translate-y-0');
        });
        
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  const section = document.querySelector('section.bg-ink-950');
  if (section) observer.observe(section);
</script>