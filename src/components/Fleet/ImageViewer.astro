---
import ImageComp from "../../components/ImageComp.astro";

interface Props {
  images: {
    src: any;
    alt: string;
  }[];
}

const { images } = Astro.props;
---
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  {images.map((img, index) => (
    <div
      class="relative aspect-video rounded-sm overflow-hidden shadow-md group cursor-pointer gallery-trigger"
      data-index={index}
    >
      <ImageComp 
        src={img.src} 
        alt={img.alt} 
        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"
      />
      <div class="absolute inset-0 bg-ink-950/20 group-hover:bg-transparent transition-colors duration-300"></div>
      <div class="absolute bottom-3 right-3 bg-black/60 backdrop-blur-sm text-white p-2 rounded-sm border border-white/20 transition-transform duration-300 group-hover:scale-110 z-10 pointer-events-none">
        <div class="flex items-center gap-2">
           <span class="text-[10px] uppercase font-bold tracking-widest hidden md:block">Expand</span>
           <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="14px" width="14px" xmlns="http://www.w3.org/2000/svg"><path d="M0 180V56c0-13.3 10.7-24 24-24h124c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H64v84c0 6.6-5.4 12-12 12H12c-6.6 0-12-5.4-12-12zM288 44v40c0 6.6 5.4 12 12 12h84v84c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12V56c0-13.3-10.7-24-24-24H300c-6.6 0-12 5.4-12 12zm148 276h-40c-6.6 0-12 5.4-12 12v84h-84c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h124c13.3 0 24-10.7 24-24V332c0-6.6-5.4-12-12-12zM160 468v-40c0-6.6-5.4-12-12-12H64v-84c0-6.6-5.4-12-12-12H12c-6.6 0-12 5.4-12 12v124c0 13.3 10.7 24 24 24h124c6.6 0 12-5.4 12-12z"></path></svg>
        </div>
      </div>
    </div>
  ))}
</div>
<div 
  id="gallery-modal"
  class="fixed inset-0 z-[9999] hidden items-center justify-center bg-ink-950/90 backdrop-blur-md"
>
  <button
    id="modal-close"
    class="absolute top-4 right-4 text-white/70 hover:text-white z-50 p-2 cursor-pointer transition-colors"
  >
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 352 512" height="30px" width="30px" xmlns="http://www.w3.org/2000/svg"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.19 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.19 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>
  </button>
  <div 
    id="modal-image-wrapper"
    class="relative max-w-[90vw] max-h-[90vh] group"
  >
    <img
      id="modal-image"
      src=""
      alt=""
      class="max-w-full max-h-[90vh] object-contain shadow-2xl rounded-sm"
    />
    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 bg-black/60 backdrop-blur-md px-4 py-2 rounded-sm border border-white/10 text-center pointer-events-none z-20 w-max max-w-[90%]">
      <p id="modal-caption" class="text-white text-sm font-medium"></p>
    </div>
    <div
      id="modal-prev"
      class="absolute top-0 bottom-0 left-0 w-12 md:w-16 bg-black/40 flex items-center justify-center text-white cursor-pointer transition-all duration-300 opacity-100 md:opacity-0 md:group-hover:opacity-100 z-30"
    >
      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="32px" width="32px" xmlns="http://www.w3.org/2000/svg"><path d="M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"></path></svg>
    </div>
    <div
      id="modal-next"
      class="absolute top-0 bottom-0 right-0 w-12 md:w-16 bg-black/40 flex items-center justify-center text-white cursor-pointer transition-all duration-300 opacity-100 md:opacity-0 md:group-hover:opacity-100 z-30"
    >
      <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="32px" width="32px" xmlns="http://www.w3.org/2000/svg"><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"></path></svg>
    </div>

  </div>
</div>

<script>
  // Get all thumbnails and extract their actual rendered src from the DOM
  const triggers = document.querySelectorAll('.gallery-trigger');
  const images = [];
  
  triggers.forEach((trigger, index) => {
    const imgElement = trigger.querySelector('img');
    if (imgElement) {
      images.push({
        src: imgElement.src,
        alt: imgElement.alt
      });
    }
  });

  let currentIndex = 0;
  const modal = document.getElementById('gallery-modal');
  const modalImage = document.getElementById('modal-image');
  const modalCaption = document.getElementById('modal-caption');
  const modalWrapper = document.getElementById('modal-image-wrapper');

  const openLightBox = (index) => {
    currentIndex = index;
    updateModalImage();
    modal.classList.remove('hidden');
    modal.classList.add('flex');
    document.body.style.overflow = 'hidden';
  };

  const closeLightBox = () => {
    modal.classList.add('hidden');
    modal.classList.remove('flex');
    document.body.style.overflow = 'auto';
  };

  const updateModalImage = () => {
    const imgData = images[currentIndex];
    modalImage.src = imgData.src;
    modalImage.alt = imgData.alt;
    modalCaption.textContent = imgData.alt;
  };

  const nextImage = (e) => {
    e?.stopPropagation();
    currentIndex = (currentIndex + 1) % images.length;
    updateModalImage();
  };

  const prevImage = (e) => {
    e?.stopPropagation();
    currentIndex = currentIndex === 0 ? images.length - 1 : currentIndex - 1;
    updateModalImage();
  };

  // Open lightbox on thumbnail click
  triggers.forEach((trigger, index) => {
    trigger.addEventListener('click', () => {
      openLightBox(index);
    });
  });

  // Close button
  document.getElementById('modal-close').addEventListener('click', closeLightBox);

  // Close on background click
  modal.addEventListener('click', closeLightBox);

  // Prevent closing when clicking on image wrapper
  modalWrapper.addEventListener('click', (e) => e.stopPropagation());

  // Navigation buttons
  document.getElementById('modal-prev').addEventListener('click', prevImage);
  document.getElementById('modal-next').addEventListener('click', nextImage);

  // Keyboard navigation
  const handleKeyDown = (e) => {
    if (modal.classList.contains('hidden')) return;
    if (e.key === 'Escape') closeLightBox();
    if (e.key === 'ArrowLeft') prevImage(e);
    if (e.key === 'ArrowRight') nextImage(e);
  };

  window.addEventListener('keydown', handleKeyDown);
</script>