---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths } from "astro";
import type { CollectionEntry } from "astro:content";

import HeroGeneralPages from "../../components/HeroGeneralPages.astro";
import ProgramIntro from "../../components/ProgramsSlug/ProgramIntro.astro";
import ProgramExpectations from "../../components/ProgramsSlug/ProgramExpectations.astro";
import WhatIsIncluded from "../../components/ProgramsSlug/WhatIsIncluded.astro";
import ContentCTA from "../../components/ProgramsSlug/ContentCTA.astro";
import WhyUs from "../../components/ProgramsSlug/WhyUs.astro";
import TargetAudience from "../../components/ProgramsSlug/TargetAudience.astro";
import TimelineProgression from "../../components/ProgramsSlug/TimelineProgression.astro";
import CareerPathways from "../../components/ProgramsSlug/CareerPathways.astro";
import EnrollmentProcess from "../../components/ProgramsSlug/EnrollmentProcess.astro";
import FAQ from "../../components/ProgramsSlug/FAQ.astro";
import FinalCTASection from "../../components/FinalCTASection.astro";
import { AIRPORT_CODE, AIRPORT_WITH_CODE_SHORT, CITY_AND_STATE, COMPANY_NAME, PHONE_NUMBER } from "../../data/consts";


export const getStaticPaths = (async () => {
  const programs = await getCollection("programs");
  return programs.map((program) => ({
    params: { slug: program.slug },
    props: { program },
  }));
}) satisfies GetStaticPaths;

type Props = {
  program: CollectionEntry<"programs">;
};

const { program } = Astro.props;
const { data } = program;

const heroData = {
  images: [
    {
      src: data.image || "/src/assets/instructing/instructing-student-how-to-repair-at-california-mh-aviation-california-commercial-pilot.webp",
      alt: data.alt || data.title || "MH Aviation Training",
      imageCentering: "object-[50%_50%]",
    },
  ],
  title: data.title || "Flight Training Program",
  subTitle: data.description || "Professional pilot training in Lancaster, CA.",
};

const finalCtaData = {
  eyebrow: "Fly This Aircraft",
  headline: "Ready for Takeoff?",
  bodyCopy: "Schedule your flight training or rental block with this aircraft today.",
  cta: {
    text: "Enroll Now",
    href: "/enroll/",
    subtext: `Call us at ${PHONE_NUMBER}`,
  },
  image: {
    src: "/src/assets/instructing/instructing-on-top-of-plane-mh-aviation-california-discovery-flight.jpg",
    alt: "Student pilot preparing for flight",
  },
};

const metaProps = {
  siteTitle: `Earn Your ${program.data.title} in ${CITY_AND_STATE} | ${COMPANY_NAME}`,
  siteDescription: `Enroll in the ${program.data.title} program at ${COMPANY_NAME} based in ${AIRPORT_WITH_CODE_SHORT}. Get professional flight training and expert mentorship to reach your aviation goals in ${CITY_AND_STATE}.`,
  siteKeywords: `${program.data.title}, ${program.data.title} Lancaster CA, learn to fly, flight training ${CITY_AND_STATE}, ${AIRPORT_CODE} flight school, ${COMPANY_NAME}`
};
---

<BaseLayout {...metaProps}>
  
  <HeroGeneralPages data={heroData} />

  {data.programIntroduction && (
    <ProgramIntro data={data.programIntroduction} />
  )}

  {data.programExpectations && (
    <ProgramExpectations data={data.programExpectations} />
  )}

  {data.firstCTA && (
    <ContentCTA data={data.firstCTA} />
  )}

  {data.whatIsIncluded && (
    <WhatIsIncluded data={data.whatIsIncluded} />
  )}

  {data.whyUs && (
    <WhyUs data={data.whyUs} />
  )}

  {data.targetAudience && (
    <TargetAudience data={data.targetAudience} />
  )}

  {data.trainingProgression && (
    <TimelineProgression data={data.trainingProgression} />
  )}

  {data.careerPathways && (
    <CareerPathways data={data.careerPathways} />
  )}

  {data.enrollmentProcess && (
    <EnrollmentProcess data={data.enrollmentProcess} />
  )}

  {data.faq && (
    <FAQ data={data.faq} />
  )}
  <FinalCTASection data={finalCtaData} />
</BaseLayout>

<script>
  const observerOptions = {
    threshold: 0.1,
    rootMargin: "0px 0px -50px 0px"
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.remove('opacity-0', 'translate-y-8');
        entry.target.classList.add('opacity-100', 'translate-y-0');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  document.querySelectorAll('.reveal-section').forEach((el) => observer.observe(el));
</script>